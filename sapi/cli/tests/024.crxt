--TEST--
multiple files syntax check
--SKIPIF--
<?crx include "skipif.inc"; ?>
--FILE--
<?crx

function run_and_output($cmd) {
    exec($cmd, $output, $exit_code);
    print_r($output);
    var_dump($exit_code);
}

$crx = getenv('TEST_CRX_EXECUTABLE_ESCAPED');

$filename_good = __DIR__."/024_good.test.crx";
$filename_good_escaped = escapeshellarg($filename_good);
$filename_bad = __DIR__."/024_bad.test.crx";
$filename_bad_escaped = escapeshellarg($filename_bad);

$code = '
<?crx

echo "hi";
';

file_put_contents($filename_good, $code);

$code = '
<?crx

class test
    private $var;
}

?>
';

file_put_contents($filename_bad, $code);

run_and_output("$crx -n -l $filename_good_escaped $filename_good_escaped 2>&1");
run_and_output("$crx -n -l $filename_good_escaped some.unknown $filename_good_escaped 2>&1");
run_and_output("$crx -n -l $filename_good_escaped $filename_bad_escaped $filename_good_escaped 2>&1");
run_and_output("$crx -n -l $filename_bad_escaped $filename_bad_escaped 2>&1");
run_and_output("$crx -n -l $filename_bad_escaped some.unknown $filename_bad_escaped 2>&1");
run_and_output("$crx -n -l $filename_bad_escaped $filename_bad_escaped some.unknown 2>&1");

echo "Done\n";
?>
--CLEAN--
<?crx
@unlink($filename_good);
@unlink($filename_bad);
?>
--EXPECTF--
Array
(
    [0] => No syntax errors detected in %s024_good.test.crx
    [1] => No syntax errors detected in %s024_good.test.crx
)
int(0)
Array
(
    [0] => No syntax errors detected in %s024_good.test.crx
    [1] => Could not open input file: some.unknown
    [2] => No syntax errors detected in %s024_good.test.crx
)
int(1)
Array
(
    [0] => No syntax errors detected in %s024_good.test.crx
    [1] => 
    [2] => Parse error: syntax error, unexpected token "private", expecting "{" in %s on line %d
    [3] => Errors parsing %s024_bad.test.crx
    [4] => No syntax errors detected in %s024_good.test.crx
)
int(255)
Array
(
    [0] => 
    [1] => Parse error: syntax error, unexpected token "private", expecting "{" in %s on line %d
    [2] => Errors parsing %s024_bad.test.crx
    [3] => 
    [4] => Parse error: syntax error, unexpected token "private", expecting "{" in %s on line %d
    [5] => Errors parsing %s024_bad.test.crx
)
int(255)
Array
(
    [0] => 
    [1] => Parse error: syntax error, unexpected token "private", expecting "{" in %s on line %d
    [2] => Errors parsing %s024_bad.test.crx
    [3] => Could not open input file: some.unknown
    [4] => 
    [5] => Parse error: syntax error, unexpected token "private", expecting "{" in %s on line %d
    [6] => Errors parsing %s024_bad.test.crx
)
int(255)
Array
(
    [0] => 
    [1] => Parse error: syntax error, unexpected token "private", expecting "{" in %s on line %d
    [2] => Errors parsing %s024_bad.test.crx
    [3] => 
    [4] => Parse error: syntax error, unexpected token "private", expecting "{" in %s on line %d
    [5] => Errors parsing %s024_bad.test.crx
    [6] => Could not open input file: some.unknown
)
int(1)
Done
