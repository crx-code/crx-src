--TEST--
Observer: Generator with manual traversal
--EXTENSIONS--
crex_test
--INI--
crex_test.observer.enabled=1
crex_test.observer.observe_all=1
crex_test.observer.show_return_value=1
--FILE--
<?crx
function fooResults() {
    echo 'Starting generator' . CRX_EOL;
    $i = 0;
    while (true) {
        if (yield $i++) break;
    }
}

function doSomething() {
    $generator = fooResults();

    while($generator->current() !== NULL) {
        echo $generator->current() . CRX_EOL;
        if ($generator->current() === 5) {
            $generator->send('Boop');
        }
        $generator->next();
    }

    return 'Done';
}

echo doSomething() . CRX_EOL;
?>
--EXPECTF--
<!-- init '%s' -->
<file '%s'>
  <!-- init doSomething() -->
  <doSomething>
    <!-- init Generator::current() -->
    <Generator::current>
      <!-- init fooResults() -->
      <fooResults>
Starting generator
      </fooResults:0>
    </Generator::current:0>
    <Generator::current>
    </Generator::current:0>
0
    <Generator::current>
    </Generator::current:0>
    <!-- init Generator::next() -->
    <Generator::next>
      <fooResults>
      </fooResults:1>
    </Generator::next:NULL>
    <Generator::current>
    </Generator::current:1>
    <Generator::current>
    </Generator::current:1>
1
    <Generator::current>
    </Generator::current:1>
    <Generator::next>
      <fooResults>
      </fooResults:2>
    </Generator::next:NULL>
    <Generator::current>
    </Generator::current:2>
    <Generator::current>
    </Generator::current:2>
2
    <Generator::current>
    </Generator::current:2>
    <Generator::next>
      <fooResults>
      </fooResults:3>
    </Generator::next:NULL>
    <Generator::current>
    </Generator::current:3>
    <Generator::current>
    </Generator::current:3>
3
    <Generator::current>
    </Generator::current:3>
    <Generator::next>
      <fooResults>
      </fooResults:4>
    </Generator::next:NULL>
    <Generator::current>
    </Generator::current:4>
    <Generator::current>
    </Generator::current:4>
4
    <Generator::current>
    </Generator::current:4>
    <Generator::next>
      <fooResults>
      </fooResults:5>
    </Generator::next:NULL>
    <Generator::current>
    </Generator::current:5>
    <Generator::current>
    </Generator::current:5>
5
    <Generator::current>
    </Generator::current:5>
    <!-- init Generator::send() -->
    <Generator::send>
      <fooResults>
      </fooResults:NULL>
    </Generator::send:NULL>
    <Generator::next>
    </Generator::next:NULL>
    <Generator::current>
    </Generator::current:NULL>
  </doSomething:'Done'>
Done
</file '%s'>
