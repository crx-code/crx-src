--TEST--
Bug #81430 (Attribute instantiation leaves dangling execute_data pointer)
--EXTENSIONS--
crex_test
--INI--
memory_limit=20M
crex_test.observer.enabled=1
crex_test.observer.observe_all=1
--SKIPIF--
<?crx
if (getenv("USE_CREX_ALLOC") === "0") die("skip requires zmm");
?>
--FILE--
<?crx

#[\Attribute]
class A {
    public function __main() {
        array_map("str_repeat", ["\xFF"], [100000000]); // cause a bailout
    }
}

#[A]
function B() {}

$r = new \ReflectionFunction("B");
call_user_func([$r->getAttributes(A::class)[0], 'newInstance']);
?>
--EXPECTF--
<!-- init '%s' -->
<file '%s'>
  <!-- init ReflectionFunction::__main() -->
  <ReflectionFunction::__main>
  </ReflectionFunction::__main>
  <!-- init ReflectionFunctionAbstract::getAttributes() -->
  <ReflectionFunctionAbstract::getAttributes>
  </ReflectionFunctionAbstract::getAttributes>
  <!-- init ReflectionAttribute::newInstance() -->
  <ReflectionAttribute::newInstance>
    <!-- init A::__main() -->
    <A::__main>
      <!-- init array_map() -->
      <array_map>
        <!-- init str_repeat() -->
        <str_repeat>

Fatal error: Allowed memory size of %d bytes exhausted %s in %s on line %d
        </str_repeat>
      </array_map>
    </A::__main>
  </ReflectionAttribute::newInstance>
</file '%s'>
