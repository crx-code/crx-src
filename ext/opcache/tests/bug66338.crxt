--TEST--
Bug #66338 (Optimization binding of class constants is not safely opcacheable)
--INI--
opcache.enable=0
--EXTENSIONS--
opcache
--CONFLICTS--
server
--FILE--
<?crx
$root  = str_replace('.crx', "", __FILE__);
$base  = basename( $root );

file_put_contents( "$root-Officials.inc", '<?crx
    class Officials { static function getLeader() { return LocalTerms::GOV_LEADER; } }
    ' );

file_put_contents( "$root-clientUS.crx", '<?crx
    class LocalTerms { const GOV_LEADER = "Barack Hussein Obama II"; }
    require \''.$root.'-Officials.inc\';
    printf( "The President of the USA is %s\n", Officials::getLeader() );
    ' );

file_put_contents( "$root-clientUK.crx", '<?crx
    class LocalTerms { const GOV_LEADER = "David William Donald Cameron"; }
    require \''.$root.'-Officials.inc\';
    printf( "The Prime Minister of the UK is %s\n", Officials::getLeader() );
    ' );

include "crx_cli_server.inc";
$uri = sprintf("http://%s/%s", CRX_CLI_SERVER_ADDRESS, basename(__FILE__));
$opt = -1;   # This test works if $opt = 0
crx_cli_server_start("-d opcache.enable=1 -d opcache.enable_cli=1 -d opcache.optimization_level=$opt -d opcache.file_update_protection=0" );

echo file_get_contents("http://" . CRX_CLI_SERVER_ADDRESS . "/$base-clientUS.crx" );
echo file_get_contents("http://" . CRX_CLI_SERVER_ADDRESS . "/$base-clientUK.crx" );

unlink("$root-Officials.inc");
unlink("$root-clientUS.crx");
unlink("$root-clientUK.crx");
?>
--EXPECT--
The President of the USA is Barack Hussein Obama II
The Prime Minister of the UK is David William Donald Cameron
