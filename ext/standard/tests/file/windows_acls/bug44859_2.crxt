--TEST--
bug #44859 (incorrect result with NTFS ACL permissions, is_readable)
--SKIPIF--
<?crx
include_once __DIR__ . '/common.inc';
skipif();
?>
--FILE--
<?crx
$uniqueBasePath = substr(__FILE__, 0, strrpos(__FILE__, '.'));
include_once __DIR__ . '/common.inc';
fix_acls();

$iteration = array(
    CRXT_ACL_READ => true,
    CRXT_ACL_NONE => false,
    CRXT_ACL_WRITE => false,
    CRXT_ACL_WRITE|CRXT_ACL_READ => true,
);

echo "Testing file:\n";
$i = 1;
$path = $uniqueBasePath . '_file.txt';
foreach ($iteration as $perms => $exp) {
    create_file($path, $perms);
    clearstatcache(true, $path);
    echo 'Iteration #' . $i++ . ': ';
    if (is_readable($path) == $exp) {
        echo "passed.\n";
    } else {
        var_dump(is_readable($path), $exp);
        echo "failed.\n";
    }
    delete_file($path);
}

echo "Testing directory:\n";
$path = $uniqueBasePath . '_dir';
$i = 1;
foreach ($iteration as $perms => $exp) {
    create_dir($path, $perms);
    clearstatcache(true, $path);
    echo 'Iteration #' . $i++ . ': ';
    if (is_readable($path) == $exp) {
        echo "passed.\n";
    } else {
        var_dump(is_readable($path), $exp);
        echo "failed.\n";
    }
    delete_dir($path);
}

?>
--EXPECT--
Testing file:
Iteration #1: passed.
Iteration #2: passed.
Iteration #3: passed.
Iteration #4: passed.
Testing directory:
Iteration #1: passed.
Iteration #2: passed.
Iteration #3: passed.
Iteration #4: passed.
