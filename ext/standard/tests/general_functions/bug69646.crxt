--TEST--
Bug #69646 OS command injection vulnerability in escapeshellarg()
--SKIPIF--
<?crx
if( substr(CRX_OS, 0, 3) != "WIN" )
  die("skip.. Windows only");
?>
--FILE--
<?crx

$a = 'a\\';
$b = 'b -c d\\';
var_dump( $a, escapeshellarg($a) );
var_dump( $b, escapeshellarg($b) );

$helper_script = <<<SCRIPT
<?crx

print( "--- ARG INFO ---\n" );
var_dump( \$argv );

SCRIPT;

$script = __DIR__ . DIRECTORY_SEPARATOR . "arginfo.crx";
file_put_contents($script, $helper_script);

$cmd = getenv('TEST_CRX_EXECUTABLE_ESCAPED') . " " . escapeshellarg($script) . " "  . escapeshellarg($a) . " " . escapeshellarg($b);

system($cmd);

unlink($script);
?>
--EXPECTF--
string(2) "a\"
string(5) ""a\\""
string(7) "b -c d\"
string(10) ""b -c d\\""
--- ARG INFO ---
array(3) {
  [0]=>
  string(%d) "%sarginfo.crx"
  [1]=>
  string(2) "a\"
  [2]=>
  string(7) "b -c d\"
}
