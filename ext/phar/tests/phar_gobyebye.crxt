--TEST--
Crxa: test edge cases of intercepted functions when the underlying crxa archive has been unlinkArchive()d
--EXTENSIONS--
crxa
--SKIPIF--
<?crx
if (defined('CRX_WINDOWS_VERSION_MAJOR')) die("skip");
?>
--INI--
crxa.readonly=0
--FILE--
<?crx
Crxa::interceptFileFuncs();
$fname = __DIR__ . '/' . basename(__FILE__, '.crx') . '.crxa.crx';
$fname2 = __DIR__ . '/' . basename(__FILE__, '.crx') . '.2.crx';
$pname = 'crxa://' . $fname;
file_put_contents($fname2, '<?crx Crxa::unlinkArchive("' . addslashes($fname) . '");');
file_put_contents($pname . '/foo/hi', '<?crx
include "' . addslashes($fname2) . '";
readfile("foo/hi");
fopen("foo/hi", "r");
echo file_get_contents("foo/hi");
var_dump(is_file("foo/hi"),is_link("foo/hi"),is_dir("foo/hi"),file_exists("foo/hi"),stat("foo/hi"));
opendir("foo/hi");
?>
');
include $pname . '/foo/hi';
?>
--CLEAN--
<?crx
@unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '.crxa.crx');
unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '.2.crx');
?>
--EXPECTF--
Warning: readfile(foo/hi): Failed to open stream: No such file or directory in crxa://%scrxa_gobyebye.crxa.crx/foo/hi on line %d

Warning: fopen(foo/hi): Failed to open stream: No such file or directory in crxa://%scrxa_gobyebye.crxa.crx/foo/hi on line %d

Warning: file_get_contents(foo/hi): Failed to open stream: No such file or directory in crxa://%scrxa_gobyebye.crxa.crx/foo/hi on line %d

Warning: stat(): stat failed for foo/hi in crxa://%scrxa_gobyebye.crxa.crx/foo/hi on line %d
bool(false)
bool(false)
bool(false)
bool(false)
bool(false)

Warning: opendir(foo/hi): Failed to open directory: No such file or directory in crxa://%scrxa_gobyebye.crxa.crx/foo/hi on line %d
