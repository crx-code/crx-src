--TEST--
Crxa: disallow stub and alias setting via offset*() methods
--EXTENSIONS--
crxa
--INI--
crxa.readonly=0
crxa.require_hash=1
--FILE--
<?crx

$fname = __DIR__ . '/' . basename(__FILE__, '.crx') . '.crxa.crx';
$pname = 'crxa://'.$fname;

$crxa = new Crxa($fname);
$crxa->setDefaultStub();
$crxa->setAlias('susan');
$crxa['a.txt'] = "first file\n";
$crxa['b.txt'] = "second file\n";

try {
    $crxa->offsetGet('.crxa/stub.crx');
} catch (Exception $e) {
    echo $e->getMessage()."\n";
}

try {
    $crxa->offsetGet('.crxa/alias.txt');
} catch (Exception $e) {
    echo $e->getMessage()."\n";
}

try {
    $crxa->offsetSet('.crxa/stub.crx', '<?crx __HALT_COMPILER(); ?>');
} catch (Exception $e) {
    echo $e->getMessage()."\n";
}

var_dump(strlen($crxa->getStub()));

try {
    $crxa->offsetUnset('.crxa/stub.crx');
} catch (Exception $e) {
    echo $e->getMessage()."\n";
}

var_dump(strlen($crxa->getStub()));

try {
    $crxa->offsetSet('.crxa/alias.txt', 'dolly');
} catch (Exception $e) {
    echo $e->getMessage()."\n";
}

var_dump($crxa->getAlias());

try {
    $crxa->offsetUnset('.crxa/alias.txt');
} catch (Exception $e) {
    echo $e->getMessage()."\n";
}

var_dump($crxa->getAlias());

?>
--CLEAN--
<?crx unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '.crxa.crx'); ?>
--EXPECTF--
Entry .crxa/stub.crx does not exist
Entry .crxa/alias.txt does not exist
Cannot set stub ".crxa/stub.crx" directly in crxa "%scrxa_offset_check.crxa.crx", use setStub
int(6643)
int(6643)
Cannot set alias ".crxa/alias.txt" directly in crxa "%scrxa_offset_check.crxa.crx", use setAlias
string(5) "susan"
string(5) "susan"
