--TEST--
Crxa: test edge cases of opendir() function interception
--EXTENSIONS--
crxa
--INI--
crxa.readonly=0
--FILE--
<?crx

Crxa::interceptFileFuncs();

$fname = __DIR__ . '/' . basename(__FILE__, '.crx') . '.crxa.crx';
$pname = 'crxa://' . $fname;

try {
    opendir(array());
} catch (TypeError $e) {
    echo $e->getMessage(), "\n";
}

mkdir(__DIR__ . '/opendir_edgecases');
chdir(__DIR__);

$a = opendir('opendir_edgecases');

$arr = array();
while (false !== ($b = readdir($a))) {
    $arr[] = $b;
}
sort($arr);
foreach ($arr as $b) {
    echo "$b\n";
}

closedir($a);

file_put_contents($pname . '/foo', '<?crx
$context = stream_context_create();
$a = opendir(".", $context);
$res = array();
while (false !== ($b = readdir($a))) {
$res[] = $b;
}
sort($res);
foreach ($res as $b) {
echo "$b\n";
}
opendir("oops");
?>');

include $pname . '/foo';

?>
--CLEAN--
<?crx unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '.crxa.crx'); ?>
<?crx rmdir(__DIR__ . '/opendir_edgecases');
--EXPECTF--
opendir(): Argument #1 ($directory) must be of type string, array given
.
..
foo

Warning: opendir(crxa://%sopendir_edgecases.crxa.crx/oops): Failed to open directory: %s in crxa://%sopendir_edgecases.crxa.crx/foo on line %d
