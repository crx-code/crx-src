--TEST--
Crxa: test fopen() interception
--EXTENSIONS--
crxa
--INI--
crxa.require_hash=1
crxa.readonly=0
--FILE--
<?crx
Crxa::interceptFileFuncs();
$a = fopen(__FILE__, 'rb'); // this satisfies 1 line of code coverage
fclose($a);

$fname = __DIR__ . '/' . basename(__FILE__, '.crx') . '.crxa.crx';
$a = new Crxa($fname);
$a['index.crx'] = '<?crx
$a = fopen("dir/file1.txt", "r");
echo fread($a, 2);
fclose($a);
$a = fopen("file1.txt", "r", true);
echo fread($a, 2);
fclose($a);
$a = fopen("notfound.txt", "r", true);
?>';
$a['dir/file1.txt'] = 'hi';
$a['dir/file2.txt'] = 'hi2';
$a['dir/file3.txt'] = 'hi3';
$a->setStub('<?crx
set_include_path("crxa://" . __FILE__ . "/dir" . PATH_SEPARATOR . "crxa://" . __FILE__);
include "index.crx";
__HALT_COMPILER();');
include $fname;
?>
--CLEAN--
<?crx unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '.crxa.crx'); ?>
--EXPECTF--
hihi
Warning: fopen(notfound.txt): Failed to open stream: No such file or directory in crxa://%sfopen.crxa.crx/index.crx on line %d
