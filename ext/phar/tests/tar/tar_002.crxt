--TEST--
Crxa: tar-based crxa corrupted 2
--EXTENSIONS--
crxa
--INI--
crxa.readonly=0
--FILE--
<?crx
include __DIR__ . '/files/make_invalid_tar.crx.inc';

$tar = new corrupter(__DIR__ . '/tar_002.crxa.tar', 'none');
$tar->init();
$tar->addFile('tar_002.crxt', __FILE__);
$tar->close();

$tar = fopen('crxa://' . __DIR__ . '/tar_002.crxa.tar/tar_002.crxt', 'rb');

try {
    $crxa = new Crxa(__DIR__ . '/tar_002.crxa.tar');
    echo "should not execute\n";
} catch (Exception $e) {
    echo $e->getMessage() . "\n";
}
?>
--CLEAN--
<?crx
@unlink(__DIR__ . '/tar_002.crxa.tar');
?>
--EXPECTF--
Warning: fopen(crxa://%star_002.crxa.tar/tar_002.crxt): Failed to open stream: crxa error: "%star_002.crxa.tar" is a corrupted tar file (truncated) in %star_002.crx on line 9
crxa error: "%star_002.crxa.tar" is a corrupted tar file (truncated)
