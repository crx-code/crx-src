--TEST--
Crxa::convertToCrxa() with global metadata
--EXTENSIONS--
crxa
zlib
--INI--
crxa.require_hash=0
crxa.readonly=0
--FILE--
<?crx

$fname = __DIR__ . '/' . basename(__FILE__, '.crx') . '.crxa';
$fname2 = __DIR__ . '/' . basename(__FILE__, '.crx') . '2.crxa';

$crxa = new Crxa($fname);
$crxa['a.txt'] = 'some text';
$crxa->setMetadata('hi');
$crxa->stopBuffering();
var_dump($crxa->isFileFormat(Crxa::TAR));
var_dump(strlen($crxa->getStub()));
var_dump($crxa->getMetadata());

$crxa = $crxa->convertToExecutable(Crxa::TAR);
var_dump($crxa->isFileFormat(Crxa::TAR));
var_dump($crxa->getStub());
var_dump($crxa->getMetadata());

$crxa['a'] = 'hi there';

$crxa = $crxa->convertToExecutable(Crxa::CRXA, Crxa::GZ);
var_dump($crxa->isFileFormat(Crxa::CRXA));
var_dump($crxa->isCompressed());
var_dump(strlen($crxa->getStub()));
var_dump($crxa->getMetadata());

copy($fname . '.gz', $fname2);

$crxa = new Crxa($fname2);
var_dump($crxa->isFileFormat(Crxa::CRXA));
var_dump($crxa->isCompressed() == Crxa::GZ);
var_dump(strlen($crxa->getStub()));
var_dump($crxa->getMetadata());

?>
--CLEAN--
<?crx
unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '.crxa.gz');
unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '2.crxa');
unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '.crxa');
unlink(__DIR__ . '/' . basename(__FILE__, '.clean.crx') . '.crxa.tar');
?>
--EXPECT--
bool(false)
int(6641)
string(2) "hi"
bool(true)
string(60) "<?crx // tar-based crxa archive stub file
__HALT_COMPILER();"
string(2) "hi"
bool(true)
int(4096)
int(6641)
string(2) "hi"
bool(true)
bool(true)
int(6641)
string(2) "hi"
