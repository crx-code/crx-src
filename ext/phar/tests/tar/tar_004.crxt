--TEST--
Crxa: tar-based crxa, tar crxa with stub, mapCrxa()
--EXTENSIONS--
crxa
--INI--
crxa.readonly=0
crxa.require_hash=0
opcache.validate_timestamps=1
--FILE--
<?crx
include __DIR__ . '/files/tarmaker.crx.inc';

$fname = __DIR__ . '/tar_004.crxa.tar';
$alias = 'crxa://' . $fname;

$tar = new tarmaker($fname, 'none');
$tar->init();
$tar->addFile('tar_004.crx', '<?crx var_dump(__FILE__);');
$tar->addFile('internal/file/here', "hi there!\n");
$tar->mkDir('internal/dir');
$tar->mkDir('dir');
$tar->addFile('.crxa/stub.crx', '<?crx
Crxa::mapCrxa();
var_dump("it worked");
include "crxa://" . __FILE__ . "/tar_004.crx";
');
$tar->close();

include $fname;
?>
--CLEAN--
<?crx
@unlink(__DIR__ . '/tar_004.crxa.tar');
?>
--EXPECTF--
string(9) "it worked"
string(%d) "crxa://%star_004.crxa.tar/tar_004.crx"
