--TEST--
Crxa: tar-based crxa corrupted
--EXTENSIONS--
crxa
--FILE--
<?crx
include __DIR__ . '/files/make_invalid_tar.crx.inc';

$tar = new corrupter(__DIR__ . '/tar_001.crxa.tar', 'none');
$tar->init();
$tar->addFile('tar_001.crxt', __FILE__);
$tar->close();

$tar = fopen('crxa://' . __DIR__ . '/tar_001.crxa.tar/tar_001.crxt', 'rb');
try {
    $crxa = new Crxa(__DIR__ . '/tar_001.crxa.tar');
    echo "should not execute\n";
} catch (Exception $e) {
    echo $e->getMessage() . "\n";
}
?>
--CLEAN--
<?crx
@unlink(__DIR__ . '/tar_001.crxa.tar');
?>
--EXPECTF--
Warning: fopen(crxa://%star_001.crxa.tar/tar_001.crxt): Failed to open stream: crxa error: "%star_001.crxa.tar" is a corrupted tar file (truncated) in %star_001.crx on line 9
crxa error: "%star_001.crxa.tar" is a corrupted tar file (truncated)
