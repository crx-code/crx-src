--TEST--
Test basic function : variation5 use_trans_sid
--INI--
session.use_strict_mode=0
session.use_only_cookies=0
session.use_trans_sid=1
session.save_handler=files
session.hash_bits_per_character=4
session.hash_function=0
session.gc_probability=1
session.gc_divisor=1000
session.gc_maxlifetime=300
session.save_path=
session.name=CRXSESSID
--EXTENSIONS--
session
--SKIPIF--
<?crx include('skipif.inc'); ?>
--FILE--
<?crx
ob_start();

$_SERVER['HTTP_HOST'] = 'crx.net';
ini_set('session.trans_sid_hosts','crx.net,example.com');

echo "*** Testing basic session functionality : variation5 use_trans_sid ***\n";
echo "*** Test trans sid ***\n";

$session_id = 'session-basic5';
session_id($session_id);
session_start();
// Should add session ID to allowed hosts only for SECURITY
echo '
<a href="/">test</a>
<a href="/path">test</a>
<a href="/path/">test</a>
<a href="/path/?foo=var">test</a>
<a href="../">test</a>
<a href="../path">test</a>
<a href="../path/">test</a>
<a href="../path/?foo=var">test</a>

<a href="/#bar">test</a>
<a href="/path/#bar">test</a>
<a href="/path/?foo=var#bar">test</a>
<a href="../#bar">test</a>
<a href="../path/#bar">test</a>
<a href="../path/?foo=var#bar">test</a>

<a href="/?foo">test</a>
<a href="/?foo#bar">test</a>
<a href="/?foo=var">test</a>
<a href="/?foo=var#bar">test</a>
<a href="../?foo">test</a>
<a href="../?foo#bar">test</a>
<a href="../?foo=var">test</a>
<a href="../?foo=var#bar">test</a>

<a href="file.crx">test</a>
<a href="file.crx?foo">test</a>
<a href="file.crx?foo=var">test</a>
<a href="file.crx?foo=var#bar">test</a>
<a href="../file.crx">test</a>
<a href="../file.crx?foo">test</a>
<a href="../file.crx?foo=var">test</a>
<a href="../file.crx?foo=var#bar">test</a>

<a href="http://crx.net">test</a>
<a href="http://crx.net/">test</a>
<a href="http://crx.net/#bar">test</a>
<a href="http://crx.net/?foo">test</a>
<a href="http://crx.net/?foo#bar">test</a>
<a href="http://crx.net/?foo=var">test</a>
<a href="http://crx.net/?foo=var#bar">test</a>
<a href="http://crx.net/file.crx">test</a>
<a href="http://crx.net/file.crx#bar">test</a>
<a href="http://crx.net/file.crx?foo">test</a>
<a href="http://crx.net/file.crx?foo#bar">test</a>
<a href="http://crx.net/file.crx?foo=var">test</a>
<a href="http://crx.net/file.crx?foo=var#bar">test</a>
<a href="http://crx.net/some/path/file.crx">test</a>
<a href="http://crx.net/some/path/file.crx?foo">test</a>
<a href="http://crx.net/some/path/file.crx?foo=var">test</a>
<a href="http://crx.net/some/path/file.crx?foo=var#bar">test</a>

<a href="https://crx.net">test</a>
<a href="https://crx.net/">test</a>
<a href="https://crx.net/?foo=var#bar">test</a>
<a href="https://crx.net/file.crx">test</a>
<a href="https://crx.net/file.crx?foo=var#bar">test</a>
<a href="https://crx.net/some/path/file.crx">test</a>
<a href="https://crx.net/some/path/file.crx?foo=var#bar">test</a>
<a href="https://crx.net:8443">test</a>
<a href="https://crx.net:8443/">test</a>
<a href="https://crx.net:8443/?foo=var#bar">test</a>
<a href="https://crx.net:8443/file.crx">test</a>
<a href="https://crx.net:8443/file.crx?foo=var#bar">test</a>
<a href="https://crx.net:8443/some/path/file.crx">test</a>
<a href="https://crx.net:8443/some/path/file.crx?foo=var#bar">test</a>

<a href="//crx.net">test</a>
<a href="//crx.net/">test</a>
<a href="//crx.net/#bar">test</a>
<a href="//crx.net/?foo">test</a>
<a href="//crx.net/?foo#bar">test</a>
<a href="//crx.net/?foo=var">test</a>
<a href="//crx.net/?foo=var#bar">test</a>
<a href="//crx.net/file.crx">test</a>
<a href="//crx.net/file.crx#bar">test</a>
<a href="//crx.net/file.crx?foo">test</a>
<a href="//crx.net/file.crx?foo#bar">test</a>
<a href="//crx.net/file.crx?foo=var">test</a>
<a href="//crx.net/file.crx?foo=var#bar">test</a>
<a href="//crx.net/some/path/file.crx">test</a>
<a href="//crx.net/some/path/file.crx?foo">test</a>
<a href="//crx.net/some/path/file.crx?foo=var">test</a>
<a href="//crx.net/some/path/file.crx?foo=var#bar">test</a>

<form action="script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="../script.crx" method="post">r
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="/path/script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="../path/script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="http://crx.net/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="https://crx.net/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="//crx.net/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>


<a href="http://bad.com">test</a>
<a href="http://bad.com/">test</a>
<a href="http://bad.com/#bar">test</a>
<a href="http://bad.com/?foo">test</a>
<a href="http://bad.com/?foo#bar">test</a>
<a href="http://bad.com/?foo=var">test</a>
<a href="http://bad.com/?foo=var#bar">test</a>
<a href="http://bad.com/file.crx">test</a>
<a href="http://bad.com/file.crx#bar">test</a>
<a href="http://bad.com/file.crx?foo">test</a>
<a href="http://bad.com/file.crx?foo#bar">test</a>
<a href="http://bad.com/file.crx?foo=var">test</a>
<a href="http://bad.com/file.crx?foo=var#bar">test</a>
<a href="http://bad.com/some/path/file.crx">test</a>
<a href="http://bad.com/some/path/file.crx?foo">test</a>
<a href="http://bad.com/some/path/file.crx?foo=var">test</a>
<a href="http://bad.com/some/path/file.crx?foo=var#bar">test</a>

<a href="https://bad.com">test</a>
<a href="https://bad.com/">test</a>
<a href="https://bad.com/?foo=var#bar">test</a>
<a href="https://bad.com/file.crx">test</a>
<a href="https://bad.com/file.crx?foo=var#bar">test</a>
<a href="https://bad.com/some/path/file.crx">test</a>
<a href="https://bad.com/some/path/file.crx?foo=var#bar">test</a>
<a href="https://bad.com:8443">test</a>
<a href="https://bad.com:8443/">test</a>
<a href="https://bad.com:8443/?foo=var#bar">test</a>
<a href="https://bad.com:8443/file.crx">test</a>
<a href="https://bad.com:8443/file.crx?foo=var#bar">test</a>
<a href="https://bad.com:8443/some/path/file.crx">test</a>
<a href="https://bad.com:8443/some/path/file.crx?foo=var#bar">test</a>

<a href="//bad.com">test</a>
<a href="//bad.com/">test</a>
<a href="//bad.com/#bar">test</a>
<a href="//bad.com/?foo">test</a>
<a href="//bad.com/?foo#bar">test</a>
<a href="//bad.com/?foo=var">test</a>
<a href="//bad.com/?foo=var#bar">test</a>
<a href="//bad.com/file.crx">test</a>
<a href="//bad.com/file.crx#bar">test</a>
<a href="//bad.com/file.crx?foo">test</a>
<a href="//bad.com/file.crx?foo#bar">test</a>
<a href="//bad.com/file.crx?foo=var">test</a>
<a href="//bad.com/file.crx?foo=var#bar">test</a>
<a href="//bad.com/some/path/file.crx">test</a>
<a href="//bad.com/some/path/file.crx?foo">test</a>
<a href="//bad.com/some/path/file.crx?foo=var">test</a>
<a href="//bad.com/some/path/file.crx?foo=var#bar">test</a>

<form action="//bad.com/script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="https://bad.com/foo/../script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="https://bad.com//path/script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="https://bad.com/foo/bar../path/script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="http://bad.com/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="https://bad.com/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="//bad.com/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>

';
var_dump(session_commit());

echo "*** Cleanup ***\n";
var_dump(session_start());
var_dump(session_id());
var_dump(session_destroy());

ob_end_flush();
?>
--EXPECT--
*** Testing basic session functionality : variation5 use_trans_sid ***
*** Test trans sid ***

<a href="/?CRXSESSID=session-basic5">test</a>
<a href="/path?CRXSESSID=session-basic5">test</a>
<a href="/path/?CRXSESSID=session-basic5">test</a>
<a href="/path/?foo=var&CRXSESSID=session-basic5">test</a>
<a href="../?CRXSESSID=session-basic5">test</a>
<a href="../path?CRXSESSID=session-basic5">test</a>
<a href="../path/?CRXSESSID=session-basic5">test</a>
<a href="../path/?foo=var&CRXSESSID=session-basic5">test</a>

<a href="/?CRXSESSID=session-basic5#bar">test</a>
<a href="/path/?CRXSESSID=session-basic5#bar">test</a>
<a href="/path/?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="../?CRXSESSID=session-basic5#bar">test</a>
<a href="../path/?CRXSESSID=session-basic5#bar">test</a>
<a href="../path/?foo=var&CRXSESSID=session-basic5#bar">test</a>

<a href="/?foo&CRXSESSID=session-basic5">test</a>
<a href="/?foo&CRXSESSID=session-basic5#bar">test</a>
<a href="/?foo=var&CRXSESSID=session-basic5">test</a>
<a href="/?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="../?foo&CRXSESSID=session-basic5">test</a>
<a href="../?foo&CRXSESSID=session-basic5#bar">test</a>
<a href="../?foo=var&CRXSESSID=session-basic5">test</a>
<a href="../?foo=var&CRXSESSID=session-basic5#bar">test</a>

<a href="file.crx?CRXSESSID=session-basic5">test</a>
<a href="file.crx?foo&CRXSESSID=session-basic5">test</a>
<a href="file.crx?foo=var&CRXSESSID=session-basic5">test</a>
<a href="file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="../file.crx?CRXSESSID=session-basic5">test</a>
<a href="../file.crx?foo&CRXSESSID=session-basic5">test</a>
<a href="../file.crx?foo=var&CRXSESSID=session-basic5">test</a>
<a href="../file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>

<a href="http://crx.net/?CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/?CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/?CRXSESSID=session-basic5#bar">test</a>
<a href="http://crx.net/?foo&CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/?foo&CRXSESSID=session-basic5#bar">test</a>
<a href="http://crx.net/?foo=var&CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="http://crx.net/file.crx?CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/file.crx?CRXSESSID=session-basic5#bar">test</a>
<a href="http://crx.net/file.crx?foo&CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/file.crx?foo&CRXSESSID=session-basic5#bar">test</a>
<a href="http://crx.net/file.crx?foo=var&CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="http://crx.net/some/path/file.crx?CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/some/path/file.crx?foo&CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/some/path/file.crx?foo=var&CRXSESSID=session-basic5">test</a>
<a href="http://crx.net/some/path/file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>

<a href="https://crx.net/?CRXSESSID=session-basic5">test</a>
<a href="https://crx.net/?CRXSESSID=session-basic5">test</a>
<a href="https://crx.net/?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="https://crx.net/file.crx?CRXSESSID=session-basic5">test</a>
<a href="https://crx.net/file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="https://crx.net/some/path/file.crx?CRXSESSID=session-basic5">test</a>
<a href="https://crx.net/some/path/file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="https://crx.net:8443/?CRXSESSID=session-basic5">test</a>
<a href="https://crx.net:8443/?CRXSESSID=session-basic5">test</a>
<a href="https://crx.net:8443/?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="https://crx.net:8443/file.crx?CRXSESSID=session-basic5">test</a>
<a href="https://crx.net:8443/file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="https://crx.net:8443/some/path/file.crx?CRXSESSID=session-basic5">test</a>
<a href="https://crx.net:8443/some/path/file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>

<a href="//crx.net/?CRXSESSID=session-basic5">test</a>
<a href="//crx.net/?CRXSESSID=session-basic5">test</a>
<a href="//crx.net/?CRXSESSID=session-basic5#bar">test</a>
<a href="//crx.net/?foo&CRXSESSID=session-basic5">test</a>
<a href="//crx.net/?foo&CRXSESSID=session-basic5#bar">test</a>
<a href="//crx.net/?foo=var&CRXSESSID=session-basic5">test</a>
<a href="//crx.net/?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="//crx.net/file.crx?CRXSESSID=session-basic5">test</a>
<a href="//crx.net/file.crx?CRXSESSID=session-basic5#bar">test</a>
<a href="//crx.net/file.crx?foo&CRXSESSID=session-basic5">test</a>
<a href="//crx.net/file.crx?foo&CRXSESSID=session-basic5#bar">test</a>
<a href="//crx.net/file.crx?foo=var&CRXSESSID=session-basic5">test</a>
<a href="//crx.net/file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>
<a href="//crx.net/some/path/file.crx?CRXSESSID=session-basic5">test</a>
<a href="//crx.net/some/path/file.crx?foo&CRXSESSID=session-basic5">test</a>
<a href="//crx.net/some/path/file.crx?foo=var&CRXSESSID=session-basic5">test</a>
<a href="//crx.net/some/path/file.crx?foo=var&CRXSESSID=session-basic5#bar">test</a>

<form action="script.crx" method="post"><input type="hidden" name="CRXSESSID" value="session-basic5" />
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="../script.crx" method="post"><input type="hidden" name="CRXSESSID" value="session-basic5" />r
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="/path/script.crx" method="post"><input type="hidden" name="CRXSESSID" value="session-basic5" />
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="../path/script.crx" method="post"><input type="hidden" name="CRXSESSID" value="session-basic5" />
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="http://crx.net/script.crx"><input type="hidden" name="CRXSESSID" value="session-basic5" />
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="https://crx.net/script.crx"><input type="hidden" name="CRXSESSID" value="session-basic5" />
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="//crx.net/script.crx"><input type="hidden" name="CRXSESSID" value="session-basic5" />
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>


<a href="http://bad.com">test</a>
<a href="http://bad.com/">test</a>
<a href="http://bad.com/#bar">test</a>
<a href="http://bad.com/?foo">test</a>
<a href="http://bad.com/?foo#bar">test</a>
<a href="http://bad.com/?foo=var">test</a>
<a href="http://bad.com/?foo=var#bar">test</a>
<a href="http://bad.com/file.crx">test</a>
<a href="http://bad.com/file.crx#bar">test</a>
<a href="http://bad.com/file.crx?foo">test</a>
<a href="http://bad.com/file.crx?foo#bar">test</a>
<a href="http://bad.com/file.crx?foo=var">test</a>
<a href="http://bad.com/file.crx?foo=var#bar">test</a>
<a href="http://bad.com/some/path/file.crx">test</a>
<a href="http://bad.com/some/path/file.crx?foo">test</a>
<a href="http://bad.com/some/path/file.crx?foo=var">test</a>
<a href="http://bad.com/some/path/file.crx?foo=var#bar">test</a>

<a href="https://bad.com">test</a>
<a href="https://bad.com/">test</a>
<a href="https://bad.com/?foo=var#bar">test</a>
<a href="https://bad.com/file.crx">test</a>
<a href="https://bad.com/file.crx?foo=var#bar">test</a>
<a href="https://bad.com/some/path/file.crx">test</a>
<a href="https://bad.com/some/path/file.crx?foo=var#bar">test</a>
<a href="https://bad.com:8443">test</a>
<a href="https://bad.com:8443/">test</a>
<a href="https://bad.com:8443/?foo=var#bar">test</a>
<a href="https://bad.com:8443/file.crx">test</a>
<a href="https://bad.com:8443/file.crx?foo=var#bar">test</a>
<a href="https://bad.com:8443/some/path/file.crx">test</a>
<a href="https://bad.com:8443/some/path/file.crx?foo=var#bar">test</a>

<a href="//bad.com">test</a>
<a href="//bad.com/">test</a>
<a href="//bad.com/#bar">test</a>
<a href="//bad.com/?foo">test</a>
<a href="//bad.com/?foo#bar">test</a>
<a href="//bad.com/?foo=var">test</a>
<a href="//bad.com/?foo=var#bar">test</a>
<a href="//bad.com/file.crx">test</a>
<a href="//bad.com/file.crx#bar">test</a>
<a href="//bad.com/file.crx?foo">test</a>
<a href="//bad.com/file.crx?foo#bar">test</a>
<a href="//bad.com/file.crx?foo=var">test</a>
<a href="//bad.com/file.crx?foo=var#bar">test</a>
<a href="//bad.com/some/path/file.crx">test</a>
<a href="//bad.com/some/path/file.crx?foo">test</a>
<a href="//bad.com/some/path/file.crx?foo=var">test</a>
<a href="//bad.com/some/path/file.crx?foo=var#bar">test</a>

<form action="//bad.com/script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="https://bad.com/foo/../script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="https://bad.com//path/script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form action="https://bad.com/foo/bar../path/script.crx" method="post">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="http://bad.com/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="https://bad.com/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>
<form method="post" action="//bad.com/script.crx">
  <input type="text" name="test1"></input>
  <input type="text" name="test2" />
</form>

bool(true)
*** Cleanup ***
bool(true)
string(14) "session-basic5"
bool(true)
